# Информационная панель — Техническая документация

## 1. Общее описание

Интерактивный дашборд управления ИТ-сервисной компанией. Единый HTML-файл (~815 КБ) со встроенными данными (JSON), стилями (CSS) и логикой (JS). Единственная внешняя зависимость — Chart.js (CDN).

Дашборд отображает операционные и клиентские метрики: трудозатраты, загрузку, производительность, заявки, SLA, выезды. Имеет два основных вида, три оси фильтрации и динамическую перерисовку всех визуализаций.

---

## 2. Архитектура файла

### 2.1 Структура dashboard_v7.html

```
<!DOCTYPE html>
├── <head>
│   ├── Chart.js CDN: https://cdn.jsdelivr.net/npm/chart.js
│   └── <style> — встроенный CSS (~510 строк)
├── <body> — HTML-разметка (~160 строк)
│   ├── Header: заголовок + сводка фильтров + кнопка "Фильтры"
│   ├── Tabs: "Операционный (ежедневный)" / "Клиентский (ежемесячный)"
│   ├── #ops — содержимое операционной вкладки
│   ├── #client — содержимое клиентской вкладки
│   └── Sidebar: панель фильтров (периоды, команды, клиенты)
├── <script>
│   ├── const D = {...}; — встроенный JSON с данными (~740 КБ)
│   └── JS-логика (~1180 строк)
```

### 2.2 Исходные файлы для сборки

При разработке дашборд разбит на 4 компонента, которые собираются Python-скриптом:

| Файл | Описание | Размер |
|---|---|---|
| `new_css.txt` | CSS-стили (тёмная тема, адаптивность) | ~510 строк |
| `new_body.txt` | HTML-разметка body (обе вкладки + sidebar) | ~160 строк |
| `v3_data.json` | Все данные дашборда | ~740 КБ |
| `new_js.txt` | Вся JS-логика (фильтры, графики, таблицы) | ~1180 строк |

### 2.3 Скрипт сборки

```python
import json

with open('new_css.txt') as f: css = f.read()
with open('new_body.txt') as f: body = f.read()
with open('new_js.txt') as f: js = f.read()
with open('v3_data.json') as f: data = json.load(f)

data_json = json.dumps(data, ensure_ascii=False)

html = f"""<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Информационная панель</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
{css}
</style>
{body}
<script>
const D = {data_json};
{js}
</script>
</html>"""

with open('dashboard_v7.html', 'w') as f:
    f.write(html)
```

---

## 3. Источники данных

### 3.1 Ежедневные отчёты (операционная вкладка)

Источник: Excel-файлы ежедневных отчётов по группам (Гамма, Альфа, Дельта, Вита, Тета, Дзета). Каждый лист — отдельная подгруппа (команда). Период: декабрь 2025 — февраль 2026.

Парсинг Excel-файлов выполняется Python-скриптом. Для каждого сотрудника/дня извлекаются:

- **ТЗТ** (трудозатраты) — часы работы
- **Бизнес заявки** (tk_b) — инциденты и запросы на обслуживание от бизнес-заказчиков
- **Бизнес задачи** (ts_b) — задачи от бизнес-заказчиков
- **Рег. заявки** (tk_r) — регламентные заявки (хранятся, но НЕ отображаются на дашборде)
- **Рег. задачи** (ts_r) — регламентные задачи (хранятся, но НЕ отображаются)
- **Выезды** (vz) — полевые выезды (есть только у команд Гамма-1: Полевые, Гамма-1А, Гамма-1Б)

Структура Excel: каждый дневной блок содержит 5 столбцов на команду: [заявки, задачи, рег, выезды, тзт]. Строка — сотрудник. Блоки сгруппированы по датам.

### 3.2 Ежемесячные отчёты (клиентская вкладка)

Источник: один Excel-файл ежемесячного отчёта. Период: август 2025 — январь 2026. Листы:

- **ТЗТ по клиентам** → `cl_tzt` (2664 записи): client, month, team, tzt_type (операционка/проект), tzt
- **Заявки** → `cl_tickets` (384 записи): client, month, type (заявки/задачи), incoming, resolved
- **SLA** → `cl_sla` (192 записи): client, month, sr (запросы %), si (инциденты %)
- **Массовые инциденты** → `cl_mass` (192 записи): client, month, mi (количество)

### 3.3 Производственный календарь

Российский производственный календарь (рабочие дни в месяце × 8 часов = норма в часах):

| Месяц | Рабочих дней | Норма (часов) |
|---|---|---|
| август 2025 | 21 | 168 |
| сентябрь 2025 | 22 | 176 |
| октябрь 2025 | 23 | 184 |
| ноябрь 2025 | 19 | 152 |
| декабрь 2025 | 22 | 176 |
| январь 2026 | 15 | 120 |
| февраль 2026 | 19 | 152 |

Праздничные дни (JS-константа `RU_HOLIDAYS`):

```
2025-11-04, 2025-12-31,
2026-01-01, 2026-01-02, 2026-01-05, 2026-01-06, 2026-01-07, 2026-01-08, 2026-01-09,
2026-02-23, 2026-03-09, 2026-05-01, 2026-05-04, 2026-05-11, 2026-06-12, 2026-11-04
```

---

## 4. Структура данных (v3_data.json)

### 4.1 Справочники

#### `hierarchy` — организационная структура
```json
{
    "Гамма": {
        "Гамма-1": ["Абдряшитов Эльнур", "Суворов Вадим"],
        "Гамма-1А": ["Беляев Александр", "Брестер Андрей", ...],
        ...
    },
    "Альфа": { ... },
    "Дельта": { ... },
    "Вита": { ... },
    "Тета": { ... },
    "Дзета": { ... }
}
```

6 групп → 11 подгрупп (команд) → ~46 сотрудников.

#### `group_map` — группа → список команд
```json
{"Гамма": ["Гамма-1", "Гамма-1А", "Гамма-1Б", "Гамма-1 Полевые", "Гамма-2"], ...}
```

#### `sg_to_group` — команда → группа
```json
{"Гамма-1": "Гамма", "Гамма-1А": "Гамма", "Альфа-1": "Альфа", ...}
```

#### `months_ops` — доступные месяцы для операционной вкладки
```json
["декабрь 2025", "январь 2026", "февраль 2026"]
```

#### `months_cl` — доступные месяцы для клиентской вкладки
```json
["август 2025", "сентябрь 2025", "октябрь 2025", "ноябрь 2025", "декабрь 2025", "январь 2026"]
```

#### `clients` — список клиентов (33 шт.)
#### `teams_cl` — список команд в клиентских данных (9 шт., нижний регистр)
```json
["вита", "гамма-1", "гамма-1А", "гамма-1Б", "гамма-2", "дельта", "дзета", "полевые", "тета"]
```

#### `prod_calendar` — рабочие дни по месяцам
```json
{"август 2025": 21, "сентябрь 2025": 22, ..., "февраль 2026": 19}
```

### 4.2 Данные операционной вкладки

#### `daily` — дневные данные (1676 записей)
```json
{
    "e": "Зайцев Александр",    // сотрудник
    "sg": "Гамма-1А",           // подгруппа (команда)
    "g": "Гамма",               // группа
    "d": "2025-12-08",          // дата
    "m": "декабрь 2025",        // месяц (label)
    "mo": 1,                    // порядковый номер месяца
    "tzt": 5.25,                // трудозатраты (часов)
    "tk_b": 3,                  // бизнес заявки
    "ts_b": 1,                  // бизнес задачи
    "tk_r": 4,                  // рег. заявки (не отображаются)
    "ts_r": 2,                  // рег. задачи (не отображаются)
    "vz": 0                     // выезды
}
```

#### `emp_monthly` — помесячные данные по сотрудникам (116 записей)
```json
{
    "employee": "Беляев Александр",
    "subgroup": "Альфа-1",
    "group": "Альфа",
    "month": "декабрь 2025",
    "month_order": 1,
    "tzt": 68.9,               // суммарные трудозатраты за месяц
    "norm": 176,               // норма (рабочие дни × 8ч)
    "util": 39.1,              // загрузка % (tzt/norm×100)
    "tk_b": 15,                // сумма бизнес заявок
    "ts_b": 6,                 // сумма бизнес задач
    "tk_r": 6,                 // сумма рег. заявок
    "ts_r": 24,                // сумма рег. задач
    "tph_b": 0.2177,           // заявок/ч (бизнес заявки): tk_b / tzt
    "tph_z": 0.0871,           // заявок/ч (бизнес задачи): ts_b / tzt
    "tph_all": 0.3048,         // заявок/ч (все бизнес): (tk_b + ts_b) / tzt
    "vz": 0                    // выезды
}
```

#### `sg_monthly` — помесячные данные по командам (26 записей)
```json
{
    "subgroup": "Альфа-1",
    "group": "Альфа",
    "month": "декабрь 2025",
    "month_order": 1,
    "tzt": 998.5,              // сумма ТЗТ команды
    "norm": 1936,              // сумма норм всех сотрудников команды
    "util": 51.6,              // загрузка % команды
    "tk_b": 773,
    "ts_b": 160,
    "tk_r": 489,
    "ts_r": 666,
    "employees": 11,           // кол-во сотрудников
    "days": 17,                // рабочих дней в данных
    "tph_b": 0.7745,
    "tph_z": 0.1603,
    "tph_all": 0.9348,
    "vz": 0
}
```

**Важно:** `norm` в `sg_monthly` — это СУММАРНАЯ норма всех сотрудников команды (например, 11 чел × 176ч = 1936ч). Это критично для корректной работы `adjNorm()`.

### 4.3 Данные клиентской вкладки

#### `cl_tzt` — ТЗТ по клиентам (2664 записи)
```json
{
    "client": "Самми Агро",
    "month": "август",
    "ml": "август 2025",       // month label (полный)
    "mo": 1,
    "team": "гамма-1А",        // команда (нижний регистр!)
    "tzt_type": "операционка", // или "проект"
    "tzt": 21.39
}
```

#### `cl_tickets` — заявки по клиентам (384 записи)
```json
{
    "client": "Самми Агро",
    "month": "август",
    "ml": "август 2025",
    "mo": 1,
    "type": "заявки",          // или "задачи"
    "incoming": 55,            // поступило
    "resolved": 41             // решено
}
```

**Важно:** на дашборде отображаются ТОЛЬКО записи с `type === 'заявки'`. Записи с `type === 'задачи'` игнорируются — они размазывают картину из-за большого количества регламентных задач.

#### `cl_sla` — SLA по клиентам (192 записи)
```json
{
    "client": "Самми Агро",
    "month": "август",
    "ml": "август 2025",
    "mo": 1,
    "sr": 76.0,                // SLA запросы (%)
    "si": 87.0                 // SLA инциденты (%)
}
```

#### `cl_mass` — массовые инциденты (192 записи)
```json
{
    "client": "Самми Агро",
    "month": "август",
    "ml": "август 2025",
    "mo": 1,
    "mi": 2                    // количество массовых инцидентов
}
```

---

## 5. Методология расчёта метрик

### 5.1 Загрузка (Утилизация)

```
Загрузка % = (ТЗТ / Скорректированная_Норма) × 100
```

**Для завершённых месяцев:** Скорректированная_Норма = Норма из данных (prod_calendar × 8ч × кол-во сотрудников).

**Для текущего (незавершённого) месяца:** применяется пропорциональная корректировка:

```
Скорректированная_Норма = Норма × (Рабочие_дни_прошедшие / Рабочие_дни_всего_в_месяце)
```

Пример для февраля 2026 (на 22 февраля): 15 из 19 рабочих дней прошло → коэффициент = 15/19 = 0.789.
Для команды Альфа-1 (8 чел): Норма = 8 × 152ч = 1216ч → Скорр. = 1216 × 0.789 = 960ч.

JS-функция: `adjNorm(monthLabel, origNorm)` — кеширует соотношение для каждого месяца, возвращает `origNorm × ratio`.

**Цветовая индикация:**
- ≥80% — зелёный (Высокая)
- ≥50% — оранжевый (Средняя)
- <50% — красный (Низкая)

### 5.2 Производительность (заявок/час)

```
TPH_заявки  = Бизнес_заявки (tk_b) / ТЗТ
TPH_задачи  = Бизнес_задачи (ts_b) / ТЗТ
TPH_все     = (tk_b + ts_b) / ТЗТ
```

**Важно:** в расчёт включаются ТОЛЬКО бизнес-тикеты (tk_b, ts_b). Регламентные (tk_r, ts_r) ИСКЛЮЧЕНЫ из метрики производительности. Регламентные заявки/задачи — рутинные операции, включение которых размывает реальную картину производительности.

Для KPI-карточки: среднее TPH по всем записям в выборке.
Для графика: TPH = (сумма tk_b + ts_b) / (сумма tzt) по каждой команде/сотруднику.

### 5.3 SLA (Доля заявок выполненных в срок)

```
SLA_клиент_месяц = (sr + si) / 2   (среднее по запросам и инцидентам)
SLA_общий = среднее SLA_клиент_месяц по всем записям в выборке
```

Если для записи есть только `sr` или только `si` (другой = null), берётся одно имеющееся значение.

### 5.4 Заявки (клиентская вкладка)

Из `cl_tickets` берутся ТОЛЬКО записи с `type === 'заявки'`. Записи с `type === 'задачи'` отфильтрованы. Порядок отображения: "Поступило / Решено" (везде единообразно).

### 5.5 Выезды

Выезды (`vz`) присутствуют ТОЛЬКО на операционной вкладке. На клиентской вкладке выездов нет, т.к. в данных нет связи "клиент ↔ выезды". Выезды есть только у трёх команд: Гамма-1 Полевые, Гамма-1А, Гамма-1Б.

### 5.6 ТЗТ по клиентам в разрезе команд

`cl_tzt` содержит поле `team` — позволяет строить разбивку ТЗТ по командам для каждого клиента. На клиентской вкладке это сводная таблица (pivot): строки = команды, столбцы = месяцы, значения = часы ТЗТ с tooltip показывающим разделение операционка/проект.

---

## 6. Маппинг имён команд

Имена команд в операционных и клиентских данных различаются регистром:

| Операционные (hierarchy) | Клиентские (teams_cl) |
|---|---|
| Гамма-1 | гамма-1 |
| Гамма-1А | гамма-1А |
| Гамма-1Б | гамма-1Б |
| Гамма-1 Полевые | полевые |
| Гамма-2 | гамма-2 |
| Альфа-1 | альфа-1 (отсутствует) |
| Альфа-2 | альфа-2 (отсутствует) |
| Дельта | дельта |
| Вита | вита |
| Тета | тета |
| Дзета | дзета |

JS выполняет маппинг через `teamNameMap`: сначала пробует точное совпадение (case-insensitive), затем совпадение по последнему слову (для "Гамма-1 Полевые" → "полевые").

**Примечание:** Альфа-1 и Альфа-2 отсутствуют в `teams_cl`, т.к. альфа-группы не работают с клиентами из ежемесячного отчёта напрямую.

---

## 7. Фильтрация

### 7.1 Состояние (state)

```javascript
state = {
    tab: 'ops',                    // текущая вкладка
    months: Set(['декабрь 2025', ...]),  // выбранные месяцы
    employees: Set(),              // выбранные сотрудники (пусто = все)
    teams: Set(['Гамма-1', ...]),  // выбранные команды
    clients: Set(['Ceva', ...])    // выбранные клиенты
}
```

### 7.2 Логика фильтрации

**Операционная вкладка:**
- Если выбраны конкретные сотрудники (`employees.size > 0`) → данные из `emp_monthly`, отфильтрованные по сотрудникам и месяцам
- Если сотрудники не выбраны → данные из `sg_monthly` (уровень команд), отфильтрованные по месяцам
- Команды не фильтруют sg_monthly напрямую — данные содержат все команды; фильтрация по сотрудникам переключает гранулярность

**Клиентская вкладка:**
- `cl_tzt` фильтруется по месяцам + командам (через маппинг) + клиентам
- `cl_tickets` фильтруется по месяцам + клиентам + `type === 'заявки'`
- `cl_sla` фильтруется по месяцам + клиентам
- `cl_mass` фильтруется по месяцам + клиентам

### 7.3 Доступность месяцев

Каждый месяц помечен флагами `ops` и `cl`. При переключении вкладки месяцы, недоступные для текущей вкладки, отключаются визуально и логически (disabled). Операционные данные: дек 2025 — фев 2026. Клиентские данные: авг 2025 — янв 2026.

### 7.4 Клик по графику ТЗТ клиентов

На клиентской вкладке клик по бару графика "ТЗТ по клиентам (топ-15)" переключает фильтр на одного клиента. Повторный клик — сбрасывает на всех.

---

## 8. Визуализации

### 8.1 Операционная вкладка

| Элемент | Тип | Описание |
|---|---|---|
| KPI-карточки | 6 шт. | Трудозатраты, Загрузка, Бизнес заявки, Бизнес задачи, Выезды, Заявки в час |
| Загрузка команд | Горизонтальный bar | % от нормы по каждой команде/сотруднику; мульти-месяц: stacked bars |
| Производительность | Горизонтальный bar | (tk_b + ts_b) / tzt по команде; мульти-месяц: stacked |
| Динамика ТЗТ | Stacked bar / горизонтальный bar | Мульти-месяц: stacked по командам × месяцы; 1 месяц: горизонтальный bar |
| Таблица | Pivot-таблица | Команда/Сотрудник × Месяцы; колонки: ТЗТ, Норма, Загрузка, Бизнес заявки, Бизнес задачи, Выезды, TPH |

### 8.2 Клиентская вкладка

| Элемент | Тип | Описание |
|---|---|---|
| KPI-карточки | 5 шт. | ТЗТ всего (опер/проект), Доля проектов %, Заявки (пост/реш), Выполнено в срок %, Масс. инциденты |
| ТЗТ по клиентам | Горизонтальный bar | Топ-15 клиентов; клик = фильтр |
| Операционка vs Проекты | Stacked bar | Горизонтальный bar: операционка + проекты по клиентам |
| ТЗТ по командам | Сводная таблица | Pivot: команды × месяцы; tooltip: разбивка опер/проект; строка "Всего" |
| Заявки: поступило vs решено | Grouped bar | По месяцам |
| SLA | Line chart | "Выполнено в срок %" по месяцам; ось Y: 0–100% |
| Таблица клиентов | Pivot-таблица | Клиент × Месяцы; строки "итого"; схлопывание пустых клиентов |

---

## 9. CSS-тема

Тёмная тема с основным цветом `#6366f1` (indigo). Ключевые цвета:
- Фон страницы: `#0f1117`
- Фон карточек/панелей: `#1a1d27`
- Границы: `#2a2d3a`
- Текст основной: `#e4e6ef`
- Текст вторичный: `#8b8fa3`
- Акцент: `#6366f1`

Адаптивная верстка:
- ≤1024px — графики в одну колонку
- ≤768px — уменьшение шрифтов и отступов в таблицах

Sidebar: фиксированный слева, 360px, анимация слайдом + overlay.

---

## 10. Организационная структура

```
Гамма (5 команд, ~22 сотрудника)
├── Гамма-1 (2): Абдряшитов Эльнур, Суворов Вадим
├── Гамма-1А (7): Беляев Александр, Брестер Андрей, Жулев Илья, Коровников Михаил, Мугли Кузьма, Пахирко Николай, Пашенцев Иван
├── Гамма-1Б (6): Зайцев Александр, Кудряшов Игорь, Лобанов Артемий, Никулин Евгений, Пашенцев Иван, Фейзрахманов Ильяс
├── Гамма-1 Полевые (3): Алиев Заур, Быстров Алексей, Стрелков Юрий
└── Гамма-2 (4): Аверин Николай, Ильин Никита, Розыев Денис, Филиппов Роман

Альфа (2 команды, 13 сотрудников)
├── Альфа-1 (11): Беляев Александр, Бритов Андрей, Васильев Борис, Константинов Джеймс, Куликов Александр, Молозин Алексей, Павлицкий Кирилл, Скутин Вадим, Чередилина Ева, Ширяев Дмитрий, Якунин Антон
└── Альфа-2 (2): Зубов Дмитрий, Меркулов Ярослав

Дельта (1 команда, 4 сотрудника)
└── Дельта: Вознюк Вадим, Николаев Александр, Соков Александр, Талдыкин Николай

Вита (1 команда, 3 сотрудника)
└── Вита: Григорьев Михаил, Лепилин Евгений, Шабанов Николай

Тета (1 команда, 3 сотрудника)
└── Тета: Боярова Екатерина, Колоскова Елена, Толоконникова Ангелина

Дзета (1 команда, 6 сотрудников)
└── Дзета: Борисовский Роман, Дитковский Андрей, Казаков Григорий, Козлов Алексей, Ларченкова Ольга, Яльчибаева Лилия
```

---

## 11. Бизнес-правила и ограничения

1. **Заявки vs Задачи**: в клиентском отчёте фильтруются только `type === 'заявки'` (инциденты + запросы). Задачи исключены, т.к. большой объём регламентных задач размывает картину.

2. **Производительность**: считается только по БИЗНЕС заявкам и задачам (tk_b + ts_b). Регламентные (tk_r, ts_r) исключены.

3. **Выезды**: отображаются ТОЛЬКО на операционной вкладке. Связь выезд↔клиент в данных отсутствует.

4. **SLA**: объединённый показатель — среднее SLA запросов (sr) и SLA инцидентов (si). Если один из показателей null, берётся имеющийся.

5. **Пустые клиенты**: если у клиента все метрики за все выбранные месяцы = 0/null, строки схлопываются в одну: "Нет данных по обращениям".

6. **Заявки в клиентской вкладке**: НЕ фильтруются по команде (в `cl_tickets` нет поля team). Фильтруются только по клиенту и периоду.

7. **Маппинг имён команд**: регистрозависимый маппинг между операционными данными (Верхний регистр: "Гамма-1А") и клиентскими (нижний: "гамма-1А"). Особый случай: "Гамма-1 Полевые" → "полевые".

---

## 12. JS-функции (справочник)

### Утилиты
| Функция | Описание |
|---|---|
| `parseMonthLabel(label)` | "декабрь 2025" → {monthName, monthNum, year} |
| `monthLabelSort(a, b)` | Сортировка месяцев хронологически |
| `getAdjustedNormRatio(monthLabel)` | Ratio прошедших/всех рабочих дней (null если месяц завершён) |
| `adjNorm(monthLabel, origNorm)` | Скорректированная норма = origNorm × ratio (кешируется) |
| `getClTeamNames()` | Маппинг выбранных команд → имена из cl_tzt |

### Фильтры
| Функция | Описание |
|---|---|
| `buildPeriods()` | Строит дерево год → месяцы с чекбоксами |
| `buildTeams()` | Строит дерево группа → команда → сотрудник |
| `buildClients()` | Строит список клиентов с чекбоксами и поиском |
| `updateSelections()` | Синхронизирует state.employees и state.teams из чекбоксов |
| `onFilterChange()` | Вызывает updateFilterSummary() + renderActiveTab() |
| `updateMonthAvailability()` | Отключает месяцы, недоступные для текущей вкладки |

### Операционная вкладка
| Функция | Описание |
|---|---|
| `renderOpsTab()` | Главная: фильтрует данные, считает KPI, вызывает все render* |
| `renderOpsLoad(data, isEmp, months)` | График загрузки |
| `renderOpsProd(data, isEmp, months)` | График производительности |
| `renderOpsDyn(data, isEmp, months)` | График динамики ТЗТ (stacked bar / horizontal bar) |
| `renderOpsTable(data, isEmp, months)` | Pivot-таблица с субтоталами |

### Клиентская вкладка
| Функция | Описание |
|---|---|
| `renderClientTab()` | Главная: фильтрует все 4 массива данных, считает KPI |
| `renderClTzt(data)` | График ТЗТ по клиентам (top-15, кликабельный) |
| `renderClOp(data)` | График Операционка vs Проекты |
| `renderClTeamTzt(data)` | Сводная таблица ТЗТ по командам |
| `renderClTk(data)` | График заявки: поступило vs решено |
| `renderClSla(data)` | Линейный график SLA |
| `renderClTable(tztD, tkD, slaD, massD)` | Pivot-таблица по клиентам |

---

## 13. Обновление данных (инструкция)

### 13.1 Добавление нового месяца операционных данных

1. Получить Excel-файл ежедневного отчёта за новый месяц
2. Парсить с тем же алгоритмом: [заявки, задачи, рег, выезды, тзт] по сотрудникам × дням
3. Добавить записи в `daily`, `emp_monthly`, `sg_monthly`
4. Пересчитать TPH: `tph_b = tk_b / tzt`, `tph_z = ts_b / tzt`, `tph_all = (tk_b + ts_b) / tzt`
5. Добавить месяц в `months_ops`
6. Обновить `prod_calendar` (кол-во рабочих дней)
7. Обновить `RU_HOLIDAYS` в JS если нужно
8. Пересобрать HTML

### 13.2 Добавление нового месяца клиентских данных

1. Получить Excel-файл ежемесячного отчёта
2. Парсить: cl_tzt, cl_tickets, cl_sla, cl_mass
3. При парсинге cl_tickets: данные содержат type='заявки' и type='задачи' — сохранять оба, фильтрация на уровне JS
4. Добавить месяц в `months_cl`
5. Обновить список клиентов и teams_cl если появились новые
6. Пересобрать HTML

### 13.3 Добавление нового сотрудника

1. Добавить в `hierarchy` → соответствующая группа → команда
2. Его данные появятся автоматически при парсинге ежедневных отчётов

### 13.4 Добавление нового клиента

1. Добавить в `clients`
2. Его данные появятся автоматически при парсинге ежемесячных отчётов

---

## 14. Известные особенности и ограничения

1. **Пашенцев Иван** дублируется — присутствует и в Гамма-1А, и в Гамма-1Б
2. **Альфа-1 и Альфа-2** отсутствуют в клиентских данных (teams_cl) — видимо, не обслуживают клиентов из ежемесячного отчёта
3. **Формат файла ~815 КБ** — большая часть это JSON-данные. При росте данных файл будет увеличиваться
4. **Браузерная производительность**: Chart.js рендерит до 11 графиков одновременно; при большом количестве данных возможны задержки
5. **Выезды доступны не для всех команд** — только Гамма-1 Полевые, Гамма-1А, Гамма-1Б (данные из sheet "гамма-1")
6. **Текущий месяц**: adjNorm автоматически корректируется при каждом открытии файла. Если файл открыть через месяц — февраль уже будет завершён и adjNorm вернёт полную норму

---

## 15. История изменений

| Версия | Изменения |
|---|---|
| v7 initial | Базовый дашборд с двумя вкладками, фильтрами |
| +SLA merge | Объединение SLA запросов и инцидентов в один показатель |
| +Выезды | Добавлены выезды на операционную вкладку |
| +Fix SLA chart | Y-ось min:0 для корректного отображения низких SLA |
| +Исключены задачи | cl_tickets фильтруется по type='заявки' |
| +Убраны выезды с кл. вкладки | Нет связи клиент↔выезды |
| +Pivot ТЗТ по командам | Сводная таблица вместо графика |
| +Stacked bar ТЗТ | Динамика ТЗТ — stacked bar вместо линейного |
| +Collapsed empty clients | Пустые клиенты показывают "Нет данных по обращениям" |
| +Fix adjNorm | Пропорциональная корректировка нормы (ratio) вместо абсолютных часов |
| +Бизнес заявки + задачи | Производительность считается по tk_b + ts_b; рег. заявки убраны из отображения |
